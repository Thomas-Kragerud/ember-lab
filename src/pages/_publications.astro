---
import BaseLayout from '@layouts/BaseLayout.astro';
import PublicationCard from '@components/cards/PublicationCard.astro';
import { getCollection } from 'astro:content';

// Load all publication entries (YAML collection)
const pubs = await getCollection('publications');

// Derive filter values at buildâ€‘time
const years = Array.from(new Set(pubs.map(p=>p.data.year))).sort((a,b)=>b-a);
---
<BaseLayout title="Publications">
  <h1 class="text-4xl font-bold mb-6">Publications</h1>

  <!-- filters -->
  <div class="mb-8 flex gap-4 flex-wrap items-center">
    <label class="text-sm font-medium">Year:
      <select id="year" class="ml-2 border rounded px-2 py-1 dark:bg-gray-800">
        <option value="all">All</option>
        {years.map(y=> <option value={y}>{y}</option>)}
      </select>
    </label>
  </div>

  <!-- list -->
  <div id="pubList" class="space-y-6">
    {pubs.map(p => (
      <div class="publication" data-year={p.data.year}>
        <PublicationCard publication={p} />
      </div>
    ))}
  </div>

  <!-- tiny filter script -->
  <script is:inline>
    const sel=document.getElementById('year');
    const items=[...document.querySelectorAll('.publication')];
    const apply=()=>{
      const y=sel.value;
      items.forEach(el=>{
        el.classList.toggle('hidden', y!=='all' && el.dataset.year!==y);
      });
    };
    sel.addEventListener('change',apply);
    apply(); // run on load
  </script>
</BaseLayout>